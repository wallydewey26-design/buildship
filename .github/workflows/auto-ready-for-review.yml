name: Auto Ready for Review

on:
  pull_request_target:
    types: [opened, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  auto-mark-ready:
    if: ${{ github.event.pull_request.draft }}
    runs-on: ubuntu-latest
    steps:
      - name: Mark pull request ready for review
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            const pull_number = context.payload.pull_request.number;
            const reviewer = 'wallydewey26';
            await github.rest.pulls.markReadyForReview({ owner, repo, pull_number });
            const requestedReviewers = (context.payload.pull_request.requested_reviewers || [])
              .map((reviewerUser) => reviewerUser.login);
            const author = context.payload.pull_request.user.login;
            if (!requestedReviewers.includes(reviewer) && author !== reviewer) {
              await github.rest.pulls.requestReviewers({
                owner,
                repo,
                pull_number,
                reviewers: [reviewer],
              });
            }
